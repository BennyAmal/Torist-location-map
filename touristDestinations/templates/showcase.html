<!-- === BEGIN HEADER === -->
<!DOCTYPE html>
{% load static %}
<!--[if IE 8]> <html lang="en" class="ie8"> <![endif]-->
<!--[if IE 9]> <html lang="en" class="ie9"> <![endif]-->
<!--[if !IE]><!-->
<html lang="en">
    <!--<![endif]-->
    <head>
        <!-- Title -->
        <title>TRAWELL</title>
        <!-- Meta -->
        <meta http-equiv="content-type" content="text/html; charset=utf-8" />
        <meta name="description" content="">
        <meta name="author" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
        <!-- Favicon -->
        <link href=" {% static 'favicon.ico' %} " rel="shortcut icon">
        <!-- Bootstrap Core CSS -->
        <link rel="stylesheet" href=" {% static 'assets/css/bootstrap.css' %} " rel="stylesheet">
        <!-- Template CSS -->
        <link rel="stylesheet" href=" {% static 'assets/css/animate.css' %} " rel="stylesheet">
        <link rel="stylesheet" href=" {% static 'assets/css/font-awesome.css' %} " rel="stylesheet">
        <link rel="stylesheet" href=" {% static 'assets/css/nexus.css' %} " rel="stylesheet">
        <link rel="stylesheet" href=" {% static 'assets/css/responsive.css' %} " rel="stylesheet">
        <link rel="stylesheet" href=" {% static 'assets/css/custom.css' %} " rel="stylesheet">
        
        <link rel="stylesheet" href=" {% static 'assets/css/styles.css' %} " rel="stylesheet">
        <!-- Google Fonts-->
        <link href="http://fonts.googleapis.com/css?family=Roboto+Condensed:400,300" rel="stylesheet" type="text/css">
        <link href="http://fonts.googleapis.com/css?family=PT+Sans" type="text/css" rel="stylesheet">
        <link href="http://fonts.googleapis.com/css?family=Roboto:400,300" rel="stylesheet" type="text/css">
    </head>
    <body>
        <div id="body-bg">
            <ul class="social-icons pull-right hidden-xs">
                <li class="social-rss">
                    <a href="https://www.instagram.com/_der_m.o.n.deur" target="_blank" title="RSS"></a>
                </li>
                <li class="social-twitter">
                    <a href="https://www.instagram.com/_der_m.o.n.deur" target="_blank" title="Twitter"></a>
                </li>
                <li class="social-facebook">
                    <a href="https://www.instagram.com/_der_m.o.n.deur" target="_blank" title="Facebook"></a>
                </li>
                <li class="social-googleplus">
                    <a href="https://www.instagram.com/_der_m.o.n.deur" target="_blank" title="GooglePlus"></a>
                </li>
            </ul>
            <div id="pre-header" class="container" style="height: 40px">
                <!-- Spacing above header -->
            </div>
            <div id="header">
                <div class="container">
                    <div class="row">
                        <!-- Logo -->
                        <div class="logo">
                            <a href=" {% static 'index.html' %} " title="">
                                <img src=" {% static 'assets/img/logo.png' %} " alt="Logo" />
                            </a>
                        </div>
                        <!-- End Logo -->
                    </div>
                </div>
            </div>
            <!-- Top Menu -->
            <div id="hornav" class="container no-padding">
                <div class="row">
                    <div class="col-md-12 no-padding">
                        <div class="text-center visible-lg">
                            <ul id="hornavmenu" class="nav navbar-nav">
                                <li>
                                    <a href="{% url 'home' %}" class="fa-home">Home</a>
                                </li>
                                <li>
                                    <span class="fa-gears">Locations</span>
                                    <ul>
                                        <li class="parent">
                                            <span>Trawell</span>
                                            <ul>
                                                <li>
                                                    <a href={% url 'showcase' %}>Explore</a>
                                                </li>
                                                <li>
                                                    <a href={% url 'showcase' %}>Our Packages</a>
                                                </li>
                                            </ul>
                                        </li>
                                        
                                </li>
                                <li>
                                    <span class="fa-th">Add a Spot</span>
                                    <ul>
                                        <li>
                                            <a href={% url 'create' %}>Add a Spot to our list</a>
                                        </li>
                                    
                                    </ul>
                                </li>
                                <li>
                                    <span class="fa-font">Update Details</span>
                                    <ul>
                                        <li>
                                            <a href={% url 'showcase' %}>Edit details</a>
                                        </li>
                                        
                                    </ul>
                                </li>
                                <li>
                                    <a href={% url 'showcase' %} class="fa-comment">View the Locations</a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <!-- End Top Menu -->
            <div id="post_header" class="container" style="height: 40px">
                <!-- Spacing below header -->
            </div>
            <div id="content-top-border" class="container">
            </div>
            <!-- === END HEADER === -->
            <!-- === BEGIN CONTENT === -->
            <div id="content">
                <div class="container background-white">
                    <div class="row margin-vert-30">
                        <h1 class="formTitle">Destinations</h1>
                        <div class="col-md-12 margin-top-30">
                            <!-- Place your form here -->

                            <!-- Add a search box above the cards -->
                            <div class="container">
                                <div class="row">
                                    <div class="col-md-6 offset-md-3">
                                        <form action="{% url 'destination-search' %}" method="GET" class="search-form" id='search-form'>
                                            <div class="input-group mb-3">
                                                <input type="text" name="query" id='search-input' class="form-control" placeholder="Search destinations...">
                                                <div class="input-group-append">
                                                    <button class="btn btn-outline-secondary" type="submit">Search</button>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>

                            <div class=row  id='destination-cards'>
                            </div>

                            <div class="row">
                                {% for destination in destinations %}
                                <div class="col-md-3 portfolio-item margin-bottom-40 design" >
                                    <div class="card_container" data-destination-id="{{ destination.id }}">
                                        <a href="{{ destination.google_map_location }}">
                                            <figure>
                                                <div class="image_container">
                                                    <img src="{{ destination.image.url }}" alt="{{ destination.place_name }}">
                                                </div>
                                                <figcaption>
                                                    <h3 class="margin-top-20">{{ destination.place_name }}</h3>
                                                    <span>{{ destination.weather }}, {{ destination.district }}</span>
                                                    <!-- Add description box -->
                                                    <div class="description-box">
                                                        <p>{{ destination.description }}</p>
                                                    </div>

                                                </figcaption>
                                            </figure>
                                        </a>

                                        
                                        <!-- Add update and delete buttons -->
                                        <div class="button-container">
                                            <button class="update-button">Update</button>
                                            <button class="delete-button">Delete</button>
                                        </div>



                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                            
                            <script>
                                document.getElementById('search-form').addEventListener('submit', function(event) {
                                    event.preventDefault(); // Prevent default form submission
                            
                                    var query = document.getElementById('search-input').value;
                            
                                    $.ajax({
                                        url: '{% url 'destination-search' %}',
                                        type: 'GET',
                                        data: { 'query': query },
                                        success: function(data) {
                                            renderDestinations(data); // Render search results directly into the container
                                        },
                                        error: function() {
                                            console.error('Error fetching search results');
                                        }
                                    });
                                });
                            
                                function renderDestinations(destinations) {
                                    var destinationCards = '';
                                    destinations.forEach(function(destination) {
                                        destinationCards += '<div class="col-md-3 portfolio-item margin-bottom-40 design">';
                                        destinationCards += '<div>';
                                        destinationCards += '<a href="' + destination.google_map_link + '">';
                                        destinationCards += '<figure>';
                                        destinationCards += '<img src="' + destination.image + '" alt="' + destination.place_name + '">';
                                        destinationCards += '<figcaption>';
                                        destinationCards += '<h3 class="margin-top-20">' + destination.place_name + '</h3>';
                                        destinationCards += '<span>' + destination.weather + ', ' + destination.district + '</span>';
                                        destinationCards += '</figcaption>';
                                        destinationCards += '</figure>';
                                        destinationCards += '</a>';
                                        destinationCards += '</div>';
                                        destinationCards += '</div>';
                                    });
                                    document.getElementById('destination-cards').innerHTML = destinationCards;
                                }


                                // Handle click event on update button
                                document.querySelectorAll('.update-button').forEach(function(button) {
                                    button.addEventListener('click', function() {
                                        // Get destination ID from the card's URL
                                        var destinationId = this.closest('.card_container').dataset.destinationId;
                                        // Redirect to the update page
                                        window.location.href = '/destinations/' + destinationId + '/update/';
                                    });
                                });


                                function getCookie(name) {
                                    var cookieValue = null;
                                    if (document.cookie && document.cookie !== '') {
                                        var cookies = document.cookie.split(';');
                                        for (var i = 0; i < cookies.length; i++) {
                                            var cookie = cookies[i].trim();
                                            // Check if the cookie contains the specified name
                                            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                                                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                                                break;
                                            }
                                        }
                                    }
                                    return cookieValue;
                                }
                                


                                // Handle click event on delete button
                                document.querySelectorAll('.delete-button').forEach(function(button) {
                                    button.addEventListener('click', function() {
                                        if (confirm('Are you sure you want to delete this destination?')) {
                                            var destinationId = this.closest('.card_container').dataset.destinationId;
                                            fetch('/destinations/' + destinationId + '/delete/', {
                                                method: 'DELETE',
                                                headers: {
                                                    'Content-Type': 'application/json',
                                                    'X-CSRFToken': getCookie('csrftoken')  // Make sure to include CSRF token
                                                }
                                            })
                                            .then(response => {
                                                if (response.ok) {
                                                    // Reload the page after successful deletion
                                                    window.location.reload();
                                                } else {
                                                    console.error('Failed to delete destination');
                                                }
                                            })
                                            .catch(error => console.error('Error:', error));
                                        }
                                    });
                                });




                            </script>
                            
                            
                            <!-- End of form -->
                        </div>
                    </div>
                </div>
            </div>
            <!-- === END CONTENT === -->
            <!-- === BEGIN FOOTER === -->
            <div id="content-bottom-border" class="container">
            </div>
            <div id="base">
                <div class="container padding-vert-30 margin-top-60">
                    <div class="row">
                        <!-- Contact Details -->
                        <div class="col-md-4 margin-bottom-20">
                            <h3 class="margin-bottom-10">Contact Details</h3>
                            <p>
                                <span class="fa-phone">Telephone:</span>+91 7986881518
                                <br>
                                <span class="fa-envelope">Email:</span>
                                <a href=" {% static link to mail %} ">amalbennymnjt@gmail.com</a>
                                <br>
                                <span class="fa-link">Website:</span>
                                <a href="http://www.youridukki.com">http://www.trawell.com</a>
                            </p>
                            <p>Calvary Mount,
                                <br>Idukki,
                                <br>Kerala,
                                <br>India</p>
                        </div>
                        <!-- End Contact Details -->
                        <!-- Sample Menu -->
                        <div class="col-md-3 margin-bottom-20">
                            <h3 class="margin-bottom-10">Other Services</h3>
                            <ul class="menu">
                                <li>
                                    <a class="fa-tasks" href="#">Travel Booking</a>
                                </li>
                                <li>
                                    <a class="fa-users" href="#">Resorts</a>
                                </li>
                                <li>
                                    <a class="fa-signal" href="#">Room Booking</a>
                                </li>
                                <li>
                                    <a class="fa-coffee" href="#">Rent a Car</a>
                                </li>
                            </ul>
                            <div class="clearfix"></div>
                        </div>
                        <!-- End Sample Menu -->
                        <div class="col-md-1"></div>
                        <!-- Disclaimer -->
                        <div class="col-md-3 margin-bottom-20 padding-vert-30 text-center">
                            <h3 class="color-gray margin-bottom-10">Join our Newsletter</h3>
                            <p>
                                Sign up for our newsletter for all the
                                <br>latest news and information
                            </p>
                            <input type="email">
                            <br>
                            <button class="btn btn-primary btn-lg margin-top-20" type="button">Subscribe</button>
                        </div>
                        <!-- End Disclaimer -->
                        <div class="clearfix"></div>
                    </div>
                </div>
            </div>
            <!-- Footer Menu -->
            <div id="footer">
                <div class="container">
                    <div class="row">
                        <div id="copyright" class="col-md-4">
                            <p class="pull-right">2024 Amal Benny</p>
                        </div>
                    </div>
                </div>
            </div>
            <!-- End Footer Menu -->
            <!-- JS -->
            <script type="text/javascript" src=" {% static 'assets/js/jquery.min.js' %} " type="text/javascript"></script>
            <script type="text/javascript" src=" {% static 'assets/js/bootstrap.min.js' %} " type="text/javascript"></script>
            <script type="text/javascript" src=" {% static 'assets/js/scripts.js' %} "></script>
            <!-- Isotope - Portfolio Sorting -->
            <script type="text/javascript" src=" {% static 'assets/js/jquery.isotope.js' %} " type="text/javascript"></script>
            <!-- Mobile Menu - Slicknav -->
            <script type="text/javascript" src=" {% static 'assets/js/jquery.slicknav.js' %} " type="text/javascript"></script>
            <!-- Animate on Scroll-->
            <script type="text/javascript" src=" {% static 'assets/js/jquery.visible.js' %} " charset="utf-8"></script>
            <!-- Sticky Div -->
            <script type="text/javascript" src=" {% static 'assets/js/jquery.sticky.js' %} " charset="utf-8"></script>
            <!-- Slimbox2-->
            <script type="text/javascript" src=" {% static 'assets/js/slimbox2.js' %} " charset="utf-8"></script>
            <!-- Modernizr -->
            <script src=" {% static 'assets/js/modernizr.custom.js' %} " type="text/javascript"></script>
            <!-- End JS -->
    </body>
</html>
<!-- === END FOOTER === -->